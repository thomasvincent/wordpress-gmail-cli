name: Custom CodeQL Configuration

# Disable default queries to use our custom ones alongside standard suites
disable-default-queries: true

# Define query suites to run
queries:
  # Run standard security and quality queries
  - uses: security-and-quality
  # Add standard security-extended queries for more comprehensive analysis
  - uses: security-extended
  # Add custom queries for PHP-specific security issues
  - name: PHP Security Queries
    uses: ./.github/codeql/security-queries/php
  # Add custom queries for JavaScript-specific security issues
  - name: JavaScript Security Queries
    uses: ./.github/codeql/security-queries/javascript # Ensure this path is correct

# Define paths to exclude from analysis
paths-ignore:
  # Dependency directories
  - '**/node_modules/**'
  - '**/vendor/**'
  # Test files (can be refined if necessary)
  - '**/*.test.js'
  - '**/*.spec.js'
  - '**/*Test.php'
  # Minified files
  - '**/*.min.js'
  - '**/*.min.css'
  # Documentation
  - '**/*.md'
  - '**/*.txt'
  - '**/docs/**'

# Define paths to include in analysis (optional, CodeQL scans all non-ignored by default)
# If specified, ONLY these paths (respecting paths-ignore) are scanned.
paths:
  # Shell scripts
  - bin
  # Specific PHP file entrypoint
  - wp-social-auth.php
  # All JavaScript files (respecting paths-ignore)
  - '**/*.js'
  # Configuration files
  - '**/*.json'
  - '**/*.yml'
  - '**/*.yaml'

# Language-specific configuration
languages:
  # JavaScript configuration
  - name: javascript
    # Specify patterns for test files (used by some metrics/queries)
    test-patterns:
      - '**/*.test.js'
      - '**/*.spec.js'
    # Configure extraction
    extraction:
      # Specify JavaScript version
      javascript:
        ecmascript: es2020

  # PHP configuration
  - name: php
    # Specify patterns for test files (used by some metrics/queries)
    test-patterns:
      - '**/*Test.php'
    # Configure indexing (fine-tune source file discovery)
    index:
      # Explicitly include all .php files (usually default, but can be specific)
      include:
        - '**/*.php'
      # Explicitly exclude vendor/tests (already covered by paths-ignore, but good practice)
      exclude:
        - '**/vendor/**'
        - '**/tests/**'
    # Configure extraction
    extraction:
      # Specify PHP version (should match version in Setup PHP step)
      php:
        version: '8.2'
        # Include standard PHP libraries for better analysis
        standard_library: true

# Database configuration
database:
  # Optimize database for better performance
  optimize: true
  # Set maximum database size (e.g., 1GB)
  max-disk-space: 1024 # In MB